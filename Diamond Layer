** Must Read
		** These scripts prepare data for BI and analystical purposes,then it identify the dimensions and fact tables. 
			changing the abbrivate forms or terms for users' familiar and make the case for proper and steady **
-- FOR dimond layer 
-- make join for business and analystical purpose
-- gnerate sergorate key to make more effecient and better performace 

-- 1. cst_info - cst_az12- loc_a101 

CREATE VIEW Dim_customer AS

SELECT 
	ROW_NUMBER() OVER( ORDER BY cst_id ) AS customer_key, -- surrograte key
	ci.cst_id 				AS customer_ID		,
    ci.cst_key 				AS customer_number	,
    ci.cst_firstname		AS first_name	,
    ci.cst_lastname			AS last_name	,
    ci.cst_marital_status	AS marital_status,
    ifnull(ca.GEN,'N/A')	As gender		,
    ci.cst_create_date	 	AS customer_create_date    ,
    ca.BDATE				AS birthday_date		,
    lo.CNTRY				AS country
FROM cst_info ci 
LEFT JOIN cst_az12 ca
ON ci.cst_key 	= ca.CID
LEFT JOIN loc_a101 lo
ON ci.cst_key = lo.CID ;

Select * From dim_customer;


-- 2. prd_info and px_cat_g1v2


CREATE VIEW Dim_product AS
SELECT 
ROW_NUMBER() OVER( ORDER BY prd_key) AS product_key,
pi.prd_id 			AS product_ID,
pi.prd_key 			As product_number,
pi.prd_nm 			AS product_name,
pi.prd_line 		AS product_line,
pi.prd_start_dt		AS start_date,
pi.cat_key 			AS category_ID,
pc.CAT 				AS category,
pc.SUBCAT 			AS  subcategory,
pi.prd_cost 		AS product_cost,
pc.MAINTENANCE 		AS maintenance

FROM prd_info pi
LEFT JOIN px_cat_g1v2 pc
ON pc.ID = replace(pi.cat_key,'-','_')
where prd_end_dt is null  -- filter out for history data 
;


SELECT * FROM dim_product;

-- sales_detail 
CREATE VIEW Fact_sales AS
SELECT 
	sd.sls_ord_num 			AS order_number	,
	vdp.Product_key 		AS product_key,
	vdc.Customer_key  		AS customer_key ,
    sd.sls_order_dt			AS order_date,
	sd.sls_ship_dt			AS ship_date	,
	sd.sls_due_dt			AS due_date		,
	sd.sls_sales			AS sales		,
	sd.sls_quantity			AS quantity	,
	sd.sls_price			AS price	
FROM sales_detail sd
LEFT JOIN dim_crm_customer vdc
ON sd.sls_cust_id = vdc.Customer_ID
LEFT JOIN dim_erp_product vdp
ON sd.sls_prd_key = vdp.Product_Number;

Select *
FROM fact_sales;    
